workflows:
  native-android:
    name: Native Android
    instance_type: linux_x2
    environment:
      vars:
        # Android Keystore environment variables
        CM_KEYSTORE: Encrypted(Z0FBQUFBQmcxSlJodXZpSEVTXzhYdmlwOVBWbkx6Zmxoa2pqTVZnMDBPYm1QYjlyZHM5M3FwRHgtajAyb2tvUTBnc092SkNwMkpoSXMtRGdHeGhnLWVNaW9oaHdnOVo1cFNjRGVGcE9SOVlLYWlJWWQ1OWVBNmd0bmUxV19EdDlFS0xueVBnNnFJcHF0dEhGOUtEUUZQN0Nqa2lOSHoybWg5SFZYMFY4TWtTSmg1NExJNlZhaVRyWVFBRWdTaDhSTTlzV3BwUXdOZTlqeUtYc2t0bGpTMFpESy1rVEJmRTNwRko2VWJkM2p2aHpYSDJTNkUyRmVrQ25nb3NJOEFXaC1WZ2duNVBqa3dtdjJlUHlTVFR1QmNPTVZhQVVYem83NnRXM3pPWGdyNVdvS2FTT2Y3VVdpRkpMb3lzSktOT05WOHBRRzZlam5udmtpYm5yVkVLN0J0WG1BVjNRSmExellydmJXa2xmemZjOFdKa0hGajVfRnd6Q042WVJuNzBQbzlXbEZESU9wdWYwVV9FWDQ1N3lpWkdBRVpJNzdMLUJfOTNKZUVmTW5ZaktwRUxXNEpwUUtWSF9rUDRnM0ppaWN6YTN0RlpSbmlvMUUyMi0zMTl3OWotd25vLVE0UmJOak1VdEVUNGc1U0pMaGlCTWJoN3dVdDhrek9LcDdVeFFWY1Vud0dRVktmdGlaYTRrbVBUWnFRWlVpRnpuNE0xODJ0VzlBNC1Td0taaFZJMFJnNkNVcFdGSV9ZWWlNdFlSRzBzVzRFWWhzT2Rfbi1DRlppUElud2lDdzg5VmYxRHd2eXhOTkw0WU1QMTg3ZkxKZmhKRlhNN0cxU19iV01yV1E0OVlYXzZhcjY3VEFwaV9XdjZURk9uMUgxUWVRWF9lcVBDTVhzOUU4S2F6NktGZlo3TE03bUY3ZlFybEo5N2NJcGZUTU5JdlZhQmJXSmRTeS04SDNjc2t1OEpiSEk0SEFGYUlhbExVbURXbTRQRWt4U2RxcjUxUEl5ME5RMUhXZVp2d1U0VVBMelZ5TTVhbkctXy1CV3FCcS13NklXc3dxNllIZldDa2ZwOFg2anZ0U2JZaWJtY005Z21XMzVBSy1LZ2NTRHNHNEU0VHdqV3VBVGVhd2F6N1Q2WFFJNmZreFR1R3k4dkRDNDFDMHZtREZKS0M2cElfLWRWeEFSbFo4VmUxVUxOTGI5U3hYNGEwZ2Y0eDByc2c4VG83MS1jODNvakpZbVJ4VExUdFhnSng0ejllU2VWMWlxVkN2RTBBMkVMdm5GdklmVXR3aE5GVUNLNUw1NjlxVzRobE1CQl9IWTlGdmtsbEFzVDRfQXY0QXpaOWhCOXkzN1BHc1dYVkJWQUM5bzAwY2hTcmNTUGNCUDFXb3hBUXlBWWNReC1pVVpCTllyMW5oLUVMNTd6OTVXWFZIMDd2UWk2MWRjQzFDYkRaZ0ZiTkxNM3l3NEZmRXVoNG94eUhGVXNfcEhvYjMtck9DdE56X1dPMDZGVm1VYzJvYlNQVFJuUVBkcUF6a2VNVFBVYVBLeFlZVnFneTUtY05vbWhnUFBJbGdFVnRCM0RkUTVxRGREMlVzS2pOQmhxRzlQbzMybElnUEJici1GUklhbmJQSUVNa19PZDJ0M3ZsdjZleE9udER0T1RNdzJBS19rVThOd05Qc1JWcFh0Znlqdk1FNE45TVRnMUlQeFFvU0tneHJlcXc3aGZFSzlqaWUxV0JnWFJYSENNaFZSZmdCcVg0dzNDTFgtS01XRkFFYkZIXzYxVkZGSjBhQUdNRk83am04NUR1RnNaVnRhYlhVR21DOGpZaUFsYVdKNzI4UW1aMUZ3OUNwVUVjNDhIcWFvc2pvVUtjbklzSHdaY0JoVXlMMHp1Qlh1b0Zuam16ZGRoUXB1RGFnYXg0M1NCdEdld2tYZ05zMnNlb2VQeWpMQm1RRXcycmk3ZzI4R2FfWDZiUmlmdFltWTNOelBjYzlEcHc0bEQxa0huUVNydkc4UXRCbGJCY004RDE3QnRCZUhpbURnZWwxNVRDekkxc3JKWXVfZXI2UUtLUkpudkg3ei1nYURFR2RpTWJYVEI1WWlXa0dnbzNMMXJhM3g0SENMbWd6eUZGaHIwTFROeExjaF9RSU9WeERORll1ZC1NdjdfM3pCZ2x4YTJKRHRUX2lldmRDdXJfNGwxeDEwd2pqV2JGSVl2SkJHR2lwX2FRb3I3VE5RaUJLdVllcEJ5YkxaM2RudWVqdUg5T19KWnpVN2plZ1NRX1RqdlZ0SlhIVTh0VU10NzRXZkh3dmlPaDBybjBaWnlKXzA0M2NMcWdWajFIQzFybndMZXhaNVBMSzdQNU5PcTBoSHE5Tjd2ZWxOaVFBYlhzd016UWF4Y1ZmN05xbHp6X09ObU8wYVUyZjg2Uk04QlNVY2w1dGpwVXhIWnhrMW9NbUpJRDVwZWdMeWZ5d1pHdjFFOTBkWVk4TFVqVnVNemNuUTU2YXpWQmRuakp6cjhON1BGc1VsZktrYnZOeHFoVnN3NlliVFlPeVFOalM2elZrcWIwdG9aeVBkekFNdzU5bVkzNFNuRjJNTXp2LVZUUFNBdERoaHp5TE1UOFY0SUNTejJMalJXZ1UtWktqY3NTRWVhVEtFWGh4dHNtMThwNi1NNVViaXFHSUlaUGV1V0pZMVZiTjA5ZUU1WklOdmk4VWRmOERQVE1COGtmcE81RTRHVVVQUnFFMkQ3U1hNSGxyYVh4RjNub3N5d3JJVy02aWQwbGk3ejZtUXUxTHhuYlRqTUJoVF9obG5XZUxST0tmMzNISmRMZmttY084VUV3bnhlWHVKM2tvb2sxcTZteFozVk1VN1F1YXVFU2V3M3ZYNENMZHB3S2h2M3g3eGJXOVpJeFlyRms5Z0FwQndGMTRUUzllYzVSeU42ZzhPX1BRa0NJMGx1MkpPd1RfMUVBLV9CRWtjc1JHbXQ5eGZ5bTMyVzlLemh6RFFQWEUtcWhBUVVmbUpNYlR6OWZpanh0cWhWbEgydXdIR0tuUE5FRFZnd3ZPYWNTVmxDdEtmaTdlWm91ZDhubG5wdU4wV0tTX1RqZldLWHRJcElnSjVXSHRqV1Zmdll1S3lhemstYWRHYzNNcVJIX1Fmakp6dGNxckJwR2txazZsZlZsVHctQXFFemhzeWQ1c0FPMHhJV0M3SEJGSWt4aHVTX3U3TjVuekM1bC01R0cxdHI2ajNzcUhPSUVhTm44NGoyaDd5NWVkZ2RFaGE4N0lSZlBPdEJKSWRxWWFVQl9QY0RLLU5US3I3THkzb3RzcTgtaWxwMWJTcjc5R0R4WFd2OG9IbGZZVndCSjh3SFdRYjRTaWF2MDk4REF1NTF1QThpRTVqcllGZHlkbEVBOUdOYUR4a1VOWVJkZUNjNUNzaTMzamJPZXhHMTROQzh4YUxVMGtodkJ2UWpQQlpjSnBqZGFISlRHbFpzTktSRDZsSXBReERDdXp3VWMtay1GWlFkWWYwRmQ3VmxpbURuTENGaHpjcGZDRGhRUkJ4aDdMRXVydl9sa3ZXRzJQNmcyX2JuTV9xczRoeFdNZDc2Q1RkYjUzckZIcWxqOUxhblRNZG01TXBreXdOY0ZhcnQyeXJ4UFpwN0pzc0NZdnlHUi05WVIxUnllNThLUEkzai1Qb19Xc0poR1hiNWt0X0ZacGtPVFFpX3NRYVBCVFg3d2dOY0lFekNYbUxwOHNFSlhldWE1b1hWQWYwNFNtS1c4Xy1MODJ5eU1sTFg2dzh1RzhPVEZKNWJTNExEcnpVZDMtNzM0THJXbm9wa3Fabmp3SV9ocXAtNzViT01SOU9MNWRXLU1PQlpyYXJLX0hCTXk2SmtYOTN0d2VWLXVZZ0MtQ18tNkpZZlZiU1hnTmh6U0RSSHV3X2JLZXVINjN1NGM1cVhHUUZPalNyMnFJbnBmeV85cDE5VUpYNkZuWlpXUmhqX0tiOFV3UUJkOWdzTHBMaU5aSjdWYUY4WnVxQlg2ckdXdHlqQ21saEs4ckdjQkVfSlIyT2NISURsTnNBM3FtTE1PNXl2YUNwb29yek9nVjBZM2ZfMGh4TjdGUkszS2FYWFhqZUZ2cTRWanVTREtmRWh4V0U4S2QtLWdBUU56ak5MTjdXYmhBTTc2OVlESW84NXVtcFlyNTRPQmtpeHJWZVdaUkpyYkp4YVRSSXRKYk5wWkNoMk9QZ2g4Sy1lV3hpajdqZGFLRnZqQTlLdklOSzFQNG1vcFN1Ym9jbmJFOE9PZ2MtTDRieXRVdTZzSG52M1pXQ3k2OV9uQk16NllCdFRpdkl4WHdIOXQzbjk2TTZXQk5vMl9XNnVVazhQTmZYOWgtSjNiWm9ZTXBKbGs5ajhMUmlMLV9CdWhETXRycnVyekhEa0dlTkYySVZFXzJxbHpWekkyNWZpQ1NKYzI1ZjV1Q1NraUktTU9uOFltWVQwS2NucmkxSU9kU1VqQnVEOEpkZHpVbS1HNEZudGdOZUF0cll6UWZkUU4ySUMzNzA4dnltWkZqWGhFeEdFRVZaWVQ5SW04aGZ2TVk0eFFoYWNkVUoydm45WExHa0J2NnJZX3BNR3BOMFdfaVZGamVtU00ybzdkd0gxUHhGck0wN0pkOHpsZllibGFFSUsxb0I4RlBMZ2lCeE1nZmFGM09seXFDOFlOcUJpSzItWS1lMnFqY1pIMTRnN2JuOEd2VWlNY25sT0t3SFo0UEJfVHFhckp1ZlRLZUF2b3VNczQ2dnZ4RTdReFlwM3BXUlg2QWtFdkxyX3IzTHROdGVrU0lUWWZSTzBFOWJTOGdlU1ZCVkR0WmNZOWxWY0N3TnQxQ0FoRjR5cmpCWnlROE4yMERwTWRjSWxJTlh1N1ZYMEJVY2RTdkRJZzBfV3JScmdObk5YQ2NCSDNvT01aNDhSa3lQRHNHNmtKRXhZdzBsOVhaVFUyNTk2bUtzNjJKMjhwNUVWYzVhVElaWXg1MU5PWS1FNzNPd2E3LTFrTTFna1hiOTYwT1BIbnN4Q19PYTdFQk9XdmM0ZWthXzAzLU1jYzZnY2x5Mi16MDIycjdjbFNZTTlRdW5BYTA1S3NVSHBOWmtrVUJMbEZidlMzeXlQMERLY1FscXFaS3B3MGVpSndNZkNJcWlNT1RWd0ZtMFJQT2FRdEdmQ0VMZ3JEa09JTkdxaWVILUVyU1JSc3ZfZm1Jd3E5dVBkdDR3OVVqdTJveWw2Mmt2ak00TnY3WjdQa2NuVE9BXzVFRTk5a2NKV1BtVnBJSHJxR1d6ejBxR1Q5SU9xY2pSSFY0T1BBMG5hMlpaM1cteS0yU0xfWi05S1A5Wk8yVUVEbVpmZHByeGNhVC13bFlhLUxpMDVNUWpuTmMyUVRobTgySjBWWHM1QXB1bkE5QjFyQ0xUcmh1ckZ4VGFzUkJtb25BRWROSEd4ZWtSdz0=) # <-- Put your encrypted keystore file here
        CM_KEYSTORE_PASSWORD: Encrypted(Z0FBQUFBQmcxSlIzUTVfQ3NUVE5OUzVOOHpyNHktUDcyR0JaQlUxUDAtakh3YTV4Z0lDU0hjVTA0UnFCR2h5Q193WnVjd0FZUy1ueHZnbnE2cDlGM3Z5ckhaZTE4YkNjYnc9PQ==) # <-- Put your encrypted keystore password here
        CM_KEY_ALIAS_PASSWORD: Encrypted(Z0FBQUFBQmcxSlIzUTVfQ3NUVE5OUzVOOHpyNHktUDcyR0JaQlUxUDAtakh3YTV4Z0lDU0hjVTA0UnFCR2h5Q193WnVjd0FZUy1ueHZnbnE2cDlGM3Z5ckhaZTE4YkNjYnc9PQ==) # <-- Put your encrypted keystore alias password here
        CM_KEY_ALIAS_USERNAME: Encrypted(Z0FBQUFBQmcxSlNwZzIxWkwzRHVRZ2s5Y2JwdDVtMXZnemVNamdsb0FqS0RoRHVLX05kdkQyOGdHbzVkRzNwR09vVnJ1eS10QWExN0tDR3lVeWxYT0hkOGk5NWtNTWIyMWc9PQ==) # <-- Put your encrypted keystore alias username here
      node: latest
      xcode: 12.2
    triggering:
      events:
        - push
        - tag
        - pull_request
      branch_patterns:
        - pattern: develop
          include: true
          source: true
    scripts:
      - name: AWS CLI configuration
        script: |
          mkdir ~/.aws
          cat >> ~/.aws/config <<EOF
          [default]
          aws_access_key_id=$AWS_ACCESS_KEY_ID
          aws_secret_access_key=$AWS_SECRET_ACCESS_KEY
          region=$AWS_DEFAULT_REGION
          output=json
          EOF
      - name: Set Android SDK location
        script: |
          echo "sdk.dir=$ANDROID_SDK_ROOT" > "$FCI_BUILD_DIR/local.properties"
      - name: Set up keystore
        script: |
          echo $CM_KEYSTORE | base64 --decode > /tmp/keystore.keystore
          cat >> "$FCI_BUILD_DIR/key.properties" <<EOF
          storePassword=$CM_KEYSTORE_PASSWORD
          keyPassword=$CM_KEY_ALIAS_PASSWORD
          keyAlias=$CM_KEY_ALIAS_USERNAME
          storeFile=/tmp/keystore.keystore
          EOF
      - name: Build Android debug APK
        script: |
          ./gradlew assembleDebug
      - name: Build Android test APK
        script: |
          ./gradlew assembleAndroidTest
      - name: Build Android production release
        script: |
          ./gradlew assembleRelease
    artifacts:
      - app/build/outputs/**/*.apk
    publishing:
      email:
        recipients:
          - nihal@nevercode.io
        notify:
          success: true
          failure: false